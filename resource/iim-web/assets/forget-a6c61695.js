import{b as k,a2 as C,r as h,d as $,bD as D,e as K,f as N,h as E,w as n,j as t,i as l,c as a,aX as f,aD as w,H as _,C as d,q as I,v as F,t as q,a$ as R,cc as T,x as U,y as V}from"./index-7540fc5d.js";import{b as B}from"./auth-7e0a8ef8.js";import{S as P,c as y,b as z}from"./common-3b825c45.js";const A=i=>(U("data-v-1ee5c380"),i=i(),V(),i),j={class:"el-container is-vertical login-box forget"},G=A(()=>l("header",{class:"el-header box-header"},[l("i",{class:"login-box-logo"}),d(" 找回密码 ")],-1)),H={class:"el-main",style:{padding:"3px"}},L={class:"helper"},M={__name:"forget",setup(i){const m=C(),v=h(),b={code:{required:!0,trigger:["blur","input"],message:"验证码不能为空"},username:{required:!0,trigger:["blur","input"],validator(o,e){if(e){if(!y(e))return new Error("请正确填写邮箱")}else return new Error("邮箱不能为空");return!0}},password:{required:!0,trigger:["blur","input"],message:"密码不能为空"}},u=h(0),g=new P("FORGET_PSW_SMS",60,o=>u.value=o),s=$({username:"",password:"",code:"",loading:!1}),x=()=>{s.loading=!0;const o=B({account:s.username,password:s.password,code:s.code});o.then(e=>{e.code==200?(window.$message.success("密码找回成功"),setTimeout(()=>{m.push("/auth/login")},500)):window.$message.warning(e.message)}),o.finally(()=>{s.loading=!1})},c=o=>{o.preventDefault(),v.value.validate(e=>{!e&&x()})},S=()=>{if(!y(s.username)){window.$message.warning("请正确填写邮箱");return}const o=z({email:s.username,channel:"forget_account"});g.start(),o.then(e=>{e.code==200?window.$message.success("验证码发送成功"):(window.$message.warning(e.message),g.end())}),o.finally(()=>{s.loading=!1})};return D(()=>{g.clear()}),(o,e)=>{const p=K("n-button");return N(),E(t(T),{theme:null},{default:n(()=>[l("section",j,[G,l("main",H,[a(t(R),{ref_key:"formRef",ref:v,size:"large",model:s,rules:b},{default:n(()=>[a(t(f),{path:"username","show-label":!1},{default:n(()=>[a(t(w),{placeholder:"邮箱",value:s.username,"onUpdate:value":e[0]||(e[0]=r=>s.username=r),onKeydown:_(c,["enter","native"])},null,8,["value","onKeydown"])]),_:1}),a(t(f),{path:"code","show-label":!1},{default:n(()=>[a(t(w),{placeholder:"验证码",maxlength:6,value:s.code,"onUpdate:value":e[1]||(e[1]=r=>s.code=r),onKeydown:_(c,["enter","native"])},null,8,["value","onKeydown"]),a(p,{tertiary:"",class:"mt-l5",onClick:S,disabled:u.value>0},{default:n(()=>[d(" 获取验证码 "),I(l("span",null,"("+q(u.value)+"s)",513),[[F,u.value>0]])]),_:1},8,["disabled"])]),_:1}),a(t(f),{path:"password","show-label":!1},{default:n(()=>[a(t(w),{placeholder:"设置密码",type:"password","show-password-on":"click",value:s.password,"onUpdate:value":e[2]||(e[2]=r=>s.password=r),onKeydown:_(c,["enter","native"])},null,8,["value","onKeydown"])]),_:1}),a(p,{type:"primary",size:"large",block:"",class:"mt-t20",onClick:c,loading:s.loading},{default:n(()=>[d(" 立即找回 ")]),_:1},8,["loading"])]),_:1},8,["model"]),l("div",L,[a(p,{text:"",color:"#D4A978",onClick:e[3]||(e[3]=r=>t(m).push("/auth/register"))},{default:n(()=>[d(" 注册账号 ")]),_:1}),a(p,{text:"",color:"#D4A978",onClick:e[4]||(e[4]=r=>t(m).push("/auth/login"))},{default:n(()=>[d(" 已有账号，立即登录? ")]),_:1})])])])]),_:1})}}},J=k(M,[["__scopeId","data-v-1ee5c380"]]);export{J as default};
